function videoBg(a,b,c){return{restrict:"EA",replace:!0,scope:{videoId:"=?",playlist:"=?",ratio:"=?",loop:"=?",mute:"=?",start:"=?",end:"=?",contentZIndex:"=?",allowClickEvents:"=?",mobileImage:"=?",playerCallback:"&?"},transclude:!0,template:"<div><div></div><div ng-transclude></div></div>",link:function(d,e,f,g){function h(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function i(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/"),d=a.indexOf("Edge/");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(c>0){var e=a.indexOf("rv:");return parseInt(a.substring(e+3,a.indexOf(".",e)),10)}return d>0?parseInt(a.substring(d+5,a.indexOf(".",d)),10):!1}function j(a,b){var c=["top","right","bottom","left"],d=function(c,d){return c[d]=parseInt(b.call(x,a+"-"+d),10),c};return c.reduce(d,{})}function k(a,b){function c(){var a,c=Array.prototype.slice.call(arguments),d=0,e=function(b,c){return a[c]?b+a[c]:b};for(var f in b)b.hasOwnProperty(f)&&(a=b[f],d+=c.reduce(e,0));return d}return{width:a.width+c("left","right"),height:i()&&i()<12?a.height:a.height+c("top","bottom")}}function l(){var a=e.children().eq(1),b=!!a.children().length,c=Array.prototype.slice.call(e.parent().children());if(e.parent().css({position:"relative",overflow:"hidden"}),!b){e.css({position:"absolute",left:"0",top:"0"});var f=c.indexOf(e[0]);f>-1&&c.splice(f,1),a=angular.element(c)}a.css({position:"relative",zIndex:d.contentZIndex||99})}function m(){x=a.getComputedStyle(e.parent()[0]);var b=["width","height"],c=["border","margin"];return i()&&i()<12&&c.push("padding"),b=b.reduce(function(a,b){return a[b]=parseInt(x.getPropertyValue(b),10),a},{}),c=c.reduce(function(a,b){return a[b]=j(b,x.getPropertyValue),a},{}),k(b,c)}function n(){var a=parseInt(A.width/d.ratio,10),b=parseInt(A.height*d.ratio,10),c=A.height<a;return{width:c?A.width:b,height:c?a:A.height}}function o(){l(),A=m(),B=n()}function p(){var a={zIndex:1,position:"absolute",width:B.width+"px",height:B.height+"px",left:parseInt((A.width-B.width)/2,10)+"px",top:parseInt((A.height-B.height)/2,10)+"px"};d.allowClickEvents||(a.pointerEvents="none"),F.css(a)}function q(a){a=a||d,z.seekTo(a.start||0)}function r(a){var b,c;a=a||d,b=a.end?a.end-(a.start||0):d.start?z.getDuration()-a.start:z.getDuration(),c=1e3*b,D=setTimeout(function(){d.playlist?z.nextVideo():q(a)},c)}function s(){var a=d.playlist[z.getPlaylistIndex()];r(a)}function t(){G&&c(function(){G({player:z})}),d.playlist&&(z.loadPlaylist(C),d.loop&&z.setLoop(!0)),d.mute&&!z.isMuted()?z.mute():z.isMuted()&&z.unMute(),q()}function u(a){if(a.data===YT.PlayerState.PLAYING&&(F.css("display","block"),!d.playlist&&d.loop&&r(),d.playlist&&d.loop&&s()),a.data===YT.PlayerState.UNSTARTED&&d.playlist){var b=d.playlist[z.getPlaylistIndex()],c=void 0===b.mute?d.mute:b.mute;H=b.mobileImage||d.mobileImage||"//img.youtube.com/vi/"+b.videoId+"/maxresdefault.jpg",w(H),F.css("display","none"),q(b),c||c&&d.mute?z.isMuted()||z.mute():c&&d.mute||z.isMuted()&&z.unMute()}}function v(){o();var a={autoplay:1,controls:0,iv_load_policy:3,cc_load_policy:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,playlist:d.videoId};z=new YT.Player(y,{width:B.width,height:B.height,videoId:d.videoId,playerVars:a,events:{onReady:t,onStateChange:u}}),F=e.children().eq(0),F.css("display","none"),p()}function w(a){e.parent().css({backgroundImage:"url("+a+")",backgroundSize:"cover",backgroundPosition:"center center"})}var x,y,z,A,B,C,D,E=document.querySelector('script[src="//www.youtube.com/iframe_api"]'),F=e.children().eq(0),G=d.playerCallback,H=d.mobileImage||"//img.youtube.com/vi/"+d.videoId+"/maxresdefault.jpg";if(y="player"+Array.prototype.slice.call(document.querySelectorAll("div[video-id]")).indexOf(e[0]),F.attr("id",y),d.ratio=d.ratio||16/9,d.loop=void 0===d.loop?!0:d.loop,d.mute=void 0===d.mute?!0:d.mute,!d.videoId&&!d.playlist)throw new Error("Either video-id or playlist must be defined.");if(d.videoId&&d.playlist)throw new Error("Both video-id and playlist cannot be defined, please choose one or the other.");if(d.playlist&&(C=d.playlist.map(function(a){return a.videoId})),w(H),!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if(!a.youTubeIframeAPIReady){var I=b.defer();a.youTubeIframeAPIReady=I.promise,a.onYouTubeIframeAPIReady=function(){I.resolve()}}if(!E){var J=document.createElement("script");J.src="//www.youtube.com/iframe_api";var K=document.getElementsByTagName("script")[0];K.parentNode.insertBefore(J,K)}a.youTubeIframeAPIReady.then(v),angular.element(a).on("resize",h(function(){o(),p()},300))}d.$watch("videoId",function(a,b){a&&b&&a!==b&&(clearTimeout(D),H=d.mobileImage||"//img.youtube.com/vi/"+a+"/maxresdefault.jpg",w(H),F.css("display","none"),z.loadVideoById(a))}),d.$watchCollection("playlist",function(a,b){a&&b&&a!==b&&(clearTimeout(D),C=a.map(function(a){return a.videoId}),z.loadPlaylist(C),d.loop&&z.setLoop(!0))})}}}angular.module("angularVideoBg",[]),angular.module("angularVideoBg").directive("videoBg",videoBg),videoBg.$inject=["$window","$q","$timeout"];